 version: 2.1

 orbs:
  win: circleci/windows@2.2.0

 jobs:
   build:
     executor: win/default
     steps:
       - checkout
       - run:
           name: "Build solution"
           command: dotnet build /p:DocumentationFile=codedoc.xml
       - run:
           name: "Pack the solution"
           command: dotnet pack
   test:
     executor: win/default
     steps:
       - run:
           name: "Test solution"
           command: dotnet test /p:CollectCoverage=true /p:CoverletOutputFormat=lcov /p:ExcludeFromCoverage="**/*.cshtml" --logger:trx --results-directory:test_coverage --collect:"Code Coverage"
       - store_artifacts:
           path: ./test_coverage
   publish:
     executor: win/default
     steps:
       - run:
           name: "Publish the solution"
           command: dotnet publish

 workflows:
    version: 2
    build-test-and-publish:
      jobs:
        - build:
            matrix:
              parameters:
                config: ["Debug", "Release"]
        - test:
            requires:
              - build
        - publish:
            requires:
              - test
